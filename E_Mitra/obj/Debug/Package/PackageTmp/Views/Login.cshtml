@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@{
    Layout = "BasePage.cshtml";
}

@{
    var redirectTo = Umbraco.Content(CurrentPage.RedirectUrl);
}
<div class="wrapper row3">
    <main class="hoc container clear" style="padding-top: 0px;">
        <!-- main body -->
        <!-- ################################################################################################ -->
        <div class="content">
            <!-- ################################################################################################ -->
            <br />
            <br />
            <div id="comments" class="contactUsForm" data-return="@redirectTo.Url">
                <form action="#" method="post" id="contactUsForm">
                    <div class="one_half first">
                        <label for="username">User Name <span>*</span></label>
                        <input name="username" id="username" value="" size="22" required="" type="text">
                    </div>
                    <div class="one_half">
                        <label for="password">Password<span>*</span></label>
                        <input name="password" id="password" value="" size="22" required="" type="password">
                    </div>
                    <div>
                        <input name="submit" value="Submit Form" type="submit">
                        &nbsp;
                        <input name="reset" value="Reset Form" type="reset">
                    </div>
                </form>
            </div>
            @*<div id="divSuccessMessageContainer">
                    @Html.Raw(CurrentPage.SuccessMessage)
                </div>*@
            <div id="divFailMessageContainer">
                Error in login
            </div>
            <!-- ################################################################################################ -->
        </div>
        <!-- ################################################################################################ -->
        <!-- / main body -->
        <div class="clear"></div>
    </main>
</div>
<style>
    #divSuccessMessageContainer, #divFailMessageContainer {
        display: none;
    }
</style>
<script>
    $(function () {
        var loginAction = function () {
            var serviceUrl = "/Umbraco/Api/Authenticate/Login";
            var ContactModel = new Object();
            ContactModel.Username = $("input[name='username']").val();
            ContactModel.Password = $("input[name='password']").val();
            console.log("ContactModel.FirstName: " + ContactModel.Username);
            console.log("ContactModel.LastName: " + ContactModel.Password);
            console.log("Json obj: " + JSON.stringify(ContactModel));

            $.ajax({
                method: 'POST',
                url: serviceUrl,
                dataType: 'json',
                data: JSON.stringify(ContactModel), //forms user object
                headers: {
                    "Content-Type": "application/json"
                },

                success: successFunc,
                error: errorFunc
            });

            function successFunc(data, status) {
                console.log(data);
                if (data === "true") {
                    console.log('Success');
                } else {
                    console.log('Failed');
                }
                var url = $(".contactUsForm").attr("data-return");
                console.log("redirect url: " + url);
                if (url === undefined) {
                    window.location.href = "/";
                } else {
                    window.location.href = url;
                }
            }

            function errorFunc() {
                console.log('error');
                $(".contactUsForm").hide();
                $("#divFailMessageContainer").show();
            }
        };

        $(".contactUsForm").submit(function (event) {
            loginAction();
            event.preventDefault();
        });
    });
</script>